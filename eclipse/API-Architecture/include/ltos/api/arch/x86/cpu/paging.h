/*
 * paging.h
 *
 *  Created on: Oct 24, 2018
 *      Author: Zekrom_64
 */

#ifndef LTOS_API_ARCH_X86_CPU_PAGING_H_
#define LTOS_API_ARCH_X86_CPU_PAGING_H_


#include "ltos/lttypes.h"

namespace ltos::x86 {

	typedef uint32_t PageEntry;

#define PAGING_MAKE_ENTRY(ADDR,FLAGS) ((ADDR&0xFFFFF000)|FLAGS)
#define PAGING_ENTRY_ADDRESS(E) (E&0xFFFFF000)
#define PAGING_ENTRY_FLAGS(E) (E&0xFFF)

	enum PageEntryFlags {
		PAGEENTRY_GLOBAL =        0b100000000,
		PAGEENTRY_DIRTY =         0b001000000,
		PAGEENTRY_ACCESSED =      0b000100000,
		PAGEENTRY_DISABLE_CACHE = 0b000010000,
		PAGEENTRY_WRITETHROUGH =  0b000001000,
		PAGEENTRY_ANY_ACCESS =    0b000000100,
		PAGEENTRY_WRITABLE =      0b000000010,
		PAGEENTRY_PRESENT =       0b000000001
	};

	typedef uint32_t PageTable;

#define PAGING_MAKE_TABLE(ADDR,FLAGS) ((ADDR&0xFFFFF000)|FLAGS)
#define PAGING_TABLE_ADDRESS(T) (T&0xFFFFF000)
#define PAGING_TABLE_FLAGS(T) (T&0xFFF)

	enum PageTableFlags {
		PAGETABLE_SIZE =          0b010000000,
		PAGETABLE_ACCESSED =      0b000100000,
		PAGETABLE_DISABLE_CACHE = 0b000010000,
		PAGETABLE_WRITETHROUGH =  0b000001000,
		PAGETABLE_ANY_ACCESS =    0b000000100,
		PAGETABLE_WRITABLE =      0b000000010,
		PAGETABLE_PRESENT =       0b000000001
	};

	typedef uint64_t PageEntry64;

#define PAGING_MAKE_ENTRY64(ADDR,FLAGS) ((ADDR&0x3FFFFFFFFFFFF000)|FLAGS)
#define PAGING_ENTRY_ADDRESS64(E) (E&0x3FFFFFFFFFFFF000)
#define PAGING_ENTRY_FLAGS64(E) (E&0xC000000000000FFF)

	enum PageEntryFlags64 {
		PAGEENTRY64_NO_EXECUTE = 0x8000000000000000
	};

	typedef uint64_t PageTable64;

}


#endif /* LTOS_API_ARCH_X86_CPU_PAGING_H_ */
